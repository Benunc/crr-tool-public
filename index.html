<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self';">
    <title>CRR Scoring Tool - Customer Response Review Tool</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a237e;
            --primary-light: #3949ab;
            --success: #4caf50;
            --warning: #ffc107;
            --danger: #f44336;
            --gray-50: #fafafa;
            --gray-100: #f5f5f5;
            --gray-200: #eeeeee;
            --gray-300: #e0e0e0;
            --gray-600: #757575;
            --gray-800: #424242;
            --gray-900: #212121;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--gray-100);
            color: var(--gray-900);
            line-height: 1.6;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            padding: 20px 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 5px;
        }

        .subtitle {
            color: var(--gray-600);
            font-size: 14px;
        }

        nav {
            background: white;
            padding: 15px 30px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            background: var(--gray-100);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-800);
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background: var(--gray-200);
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
        }

        .view {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .view.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--gray-800);
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            padding: 20px;
            background: var(--gray-50);
        }

        .metric-card h3 {
            color: var(--primary);
            font-size: 16px;
            margin-bottom: 10px;
        }

        .metric-card .question {
            font-size: 13px;
            color: var(--gray-600);
            font-style: italic;
            margin-bottom: 15px;
        }

        .score-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .score-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--gray-300);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .score-btn:hover {
            border-color: var(--primary-light);
        }

        .score-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .score-btn.score-1.selected {
            background: var(--danger);
            border-color: var(--danger);
        }

        .score-btn.score-3.selected {
            background: var(--success);
            border-color: var(--success);
        }

        /* Quick select styling */
        .quick-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px 12px;
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-option:hover {
            background: var(--gray-100);
            border-color: var(--gray-300);
        }

        .quick-option input[type="checkbox"] {
            margin: 0;
            margin-right: 10px;
            width: 16px;
            height: 16px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .quick-option label {
            margin: 0;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-700);
            cursor: pointer;
            flex: 1;
        }

        .quick-option:last-child {
            margin-bottom: 0;
        }

        .score-hint {
            font-size: 12px;
            color: var(--gray-600);
            line-height: 1.4;
        }


        .btn {
            padding: 12px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--primary-light);
        }

        .btn-secondary {
            background: var(--gray-600);
        }

        .btn-secondary:hover {
            background: var(--gray-800);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .total-score {
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }

        .total-score .number {
            font-size: 48px;
            font-weight: bold;
        }

        .total-score .label {
            font-size: 14px;
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background: var(--gray-100);
            font-weight: 600;
            color: var(--gray-800);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: var(--gray-50);
        }

        table a:hover {
            text-decoration: underline;
        }

        .score-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .score-badge.high {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .score-badge.medium {
            background: #fff9c4;
            color: #f57f17;
        }

        .score-badge.low {
            background: #ffcdd2;
            color: #c62828;
        }

        /* Total score styling - just darker/lighter with good contrast */
        .score-badge.total-high {
            background: #1a1a1a;
            color: #ffffff;
            font-weight: 600;
        }

        .score-badge.total-medium {
            background: #4a4a4a;
            color: #ffffff;
        }

        .score-badge.total-low {
            background: #757575;
            color: #ffffff;
        }

        /* Individual metric styling - red to green progression with accessible contrast */
        .score-badge.metric-danger {
            background: #ffebee;
            color: #b71c1c;
            border: 1px solid #e57373;
            font-weight: 500;
        }

        .score-badge.metric-warning {
            background: #fff8e1;
            color: #e65100;
            border: 1px solid #ffb74d;
            font-weight: 500;
        }

        .score-badge.metric-good {
            background: #e8f5e8;
            color: #1b5e20;
            border: 1px solid #81c784;
            font-weight: 500;
        }

        .score-badge.metric-excellent {
            background: #c8e6c9;
            color: #0d4f0d;
            border: 1px solid #4caf50;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 30px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--gray-50);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-card .label {
            font-size: 13px;
            color: var(--gray-600);
            margin-top: 5px;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-bar select {
            width: auto;
            min-width: 150px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-600);
        }

        .empty-state h3 {
            color: var(--gray-800);
            margin-bottom: 10px;
        }

        .guide-section {
            margin-bottom: 40px;
        }

        .guide-section h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 22px;
        }

        .guide-section h3 {
            color: var(--gray-800);
            margin: 20px 0 10px;
            font-size: 18px;
        }

        .scoring-table {
            margin: 20px 0;
        }

        .scoring-table td:first-child {
            font-weight: 600;
            color: var(--primary);
        }

        .example-box {
            background: var(--gray-50);
            padding: 15px;
            border-left: 4px solid var(--primary);
            margin: 15px 0;
            border-radius: 4px;
        }

        .example-box.dont {
            border-left-color: var(--danger);
        }

        .example-box.do {
            border-left-color: var(--success);
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .alert-warning {
            background: #fff9c4;
            color: #f57f17;
        }

        .red-flag {
            color: var(--danger);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            header, nav, .view {
                padding: 15px;
            }

            .form-row, .metric-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- DEMO VERSION BANNER -->
    <div id="demo-banner" style="
        position: fixed; 
        top: 0; 
        left: 0; 
        right: 0; 
        background: linear-gradient(90deg, #ff6b6b, #4ecdc4); 
        color: white; 
        text-align: center; 
        padding: 8px; 
        font-weight: bold; 
        z-index: 10001;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    ">
        🎭 DEMO VERSION - <a href="https://buildsustainablesupport.com" style="color: white; text-decoration: underline;">Get Full Version</a> 🚀
    </div>
    <style>
        body { padding-top: 40px; }
    </style>
    <div class="app-container">
        <header>
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                <img src="SS_logo.png" alt="Sustainable Support Logo" style="height: 40px; width: auto; border-radius: 4px;">
                <div>
                    <h1 style="margin: 0; font-size: 28px;">CRR Scoring Tool</h1>
                    <p class="subtitle" style="margin: 5px 0 0 0; font-size: 14px;">Customer Response Review Tool - Based on the methodology in "Sustainable Support" by Ben Meredith</p>
                </div>
            </div>
        </header>

        <nav>
            <button class="nav-btn active" onclick="showView('score-entry', this)">New CRR</button>
            <button class="nav-btn" onclick="showView('all-reviews', this)">All Reviews</button>
            <button class="nav-btn" onclick="showDemoRestriction('dashboard')">Agent Dashboard</button>
            <button class="nav-btn" onclick="showDemoRestriction('analytics')">Team Overview</button>
            <button class="nav-btn" onclick="showView('scoring-guide', this)">Scoring Guide</button>
            <button class="nav-btn" onclick="showView('settings', this)">Settings</button>
        </nav>

        <!-- Score Entry View -->
        <div id="score-entry" class="view active">
            <h2>New Customer Response Review</h2>
            <form id="crr-form" onsubmit="saveCRR(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="review-date">Date</label>
                        <input type="date" id="review-date" required>
                    </div>
                    <div class="form-group">
                        <label for="agent-name">Agent Name</label>
                        <select id="agent-name" required onchange="autoFillSupervisor()">
                            <option value="">Select Agent...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="supervisor-name">Supervisor <span style="font-size: 12px; color: var(--gray-600);">(auto-filled)</span></label>
                        <select id="supervisor-name" required>
                            <option value="">Select Supervisor...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="interaction-type">Interaction Type</label>
                        <select id="interaction-type" required>
                            <option value="Ticket">Ticket</option>
                            <option value="Chat">Chat</option>
                            <option value="Call">Call</option>
                            <option value="Bot Response">Bot Response</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="interaction-link">Link to Interaction</label>
                    <input type="url" id="interaction-link" placeholder="https://support.example.com/ticket/12345" required>
                </div>

                <h3 style="margin: 30px 0 20px; color: var(--primary);">Score the 4 Metrics</h3>
                
                <div class="metric-grid">
                    <!-- Expertise -->
                    <div class="metric-card">
                        <h3>1. Expertise</h3>
                        <p class="question">Do they demonstrate technical grasp of the problem and surrounding issues?</p>
                        <div class="score-buttons">
                            <button type="button" class="score-btn score-1" onclick="selectScore('expertise', 1)">1</button>
                            <button type="button" class="score-btn score-2" onclick="selectScore('expertise', 2)">2</button>
                            <button type="button" class="score-btn score-3" onclick="selectScore('expertise', 3)">3</button>
                        </div>
                        <p class="score-hint" id="expertise-hint">Select a score</p>
                        <input type="hidden" id="expertise-score" required>
                        <div id="expertise-feedback-container" style="display: none; margin-top: 15px;">
                            <div id="expertise-quick-options" style="display: none; margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border: 1px solid var(--gray-300);">
                                <p style="font-size: 12px; font-weight: 600; margin-bottom: 8px; color: var(--gray-700);">Quick select (optional):</p>
                            </div>
                            <label for="expertise-feedback" id="expertise-feedback-label" style="font-size: 13px; margin-bottom: 5px; display: block;"></label>
                            <textarea id="expertise-feedback" style="width: 100%; min-height: 60px; font-size: 13px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 4px;"></textarea>
                        </div>
                    </div>

                    <!-- Ownership -->
                    <div class="metric-card">
                        <h3>2. Ownership</h3>
                        <p class="question">Do they avoid passing off responsibility to others?</p>
                        <div class="score-buttons">
                            <button type="button" class="score-btn score-1" onclick="selectScore('ownership', 1)">1</button>
                            <button type="button" class="score-btn score-2" onclick="selectScore('ownership', 2)">2</button>
                            <button type="button" class="score-btn score-3" onclick="selectScore('ownership', 3)">3</button>
                        </div>
                        <p class="score-hint" id="ownership-hint">Select a score</p>
                        <input type="hidden" id="ownership-score" required>
                        <div id="ownership-feedback-container" style="display: none; margin-top: 15px;">
                            <div id="ownership-quick-options" style="display: none; margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border: 1px solid var(--gray-300);">
                                <p style="font-size: 12px; font-weight: 600; margin-bottom: 8px; color: var(--gray-700);">Quick select (optional):</p>
                            </div>
                            <label for="ownership-feedback" id="ownership-feedback-label" style="font-size: 13px; margin-bottom: 5px; display: block;"></label>
                            <textarea id="ownership-feedback" style="width: 100%; min-height: 60px; font-size: 13px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 4px;"></textarea>
                        </div>
                    </div>

                    <!-- Articulation -->
                    <div class="metric-card">
                        <h3>3. Articulation</h3>
                        <p class="question">Do they communicate clearly with helpful tone and attention to detail?</p>
                        <div class="score-buttons">
                            <button type="button" class="score-btn score-1" onclick="selectScore('articulation', 1)">1</button>
                            <button type="button" class="score-btn score-2" onclick="selectScore('articulation', 2)">2</button>
                            <button type="button" class="score-btn score-3" onclick="selectScore('articulation', 3)">3</button>
                        </div>
                        <p class="score-hint" id="articulation-hint">Select a score</p>
                        <input type="hidden" id="articulation-score" required>
                        <div id="articulation-feedback-container" style="display: none; margin-top: 15px;">
                            <div id="articulation-quick-options" style="display: none; margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border: 1px solid var(--gray-300);">
                                <p style="font-size: 12px; font-weight: 600; margin-bottom: 8px; color: var(--gray-700);">Quick select (optional):</p>
                            </div>
                            <label for="articulation-feedback" id="articulation-feedback-label" style="font-size: 13px; margin-bottom: 5px; display: block;"></label>
                            <textarea id="articulation-feedback" style="width: 100%; min-height: 60px; font-size: 13px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 4px;"></textarea>
                        </div>
                    </div>

                    <!-- Proactiveness -->
                    <div class="metric-card">
                        <h3>4. Proactiveness</h3>
                        <p class="question">Do they utilize opportunities to maximize long-term benefits?</p>
                        <div class="score-buttons">
                            <button type="button" class="score-btn score-1" onclick="selectScore('proactiveness', 1)">1</button>
                            <button type="button" class="score-btn score-2" onclick="selectScore('proactiveness', 2)">2</button>
                            <button type="button" class="score-btn score-3" onclick="selectScore('proactiveness', 3)">3</button>
                        </div>
                        <p class="score-hint" id="proactiveness-hint">Select a score</p>
                        <input type="hidden" id="proactiveness-score" required>
                        <div id="proactiveness-feedback-container" style="display: none; margin-top: 15px;">
                            <div id="proactiveness-quick-options" style="display: none; margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border: 1px solid var(--gray-300);">
                                <p style="font-size: 12px; font-weight: 600; margin-bottom: 8px; color: var(--gray-700);">Quick select (optional):</p>
                            </div>
                            <label for="proactiveness-feedback" id="proactiveness-feedback-label" style="font-size: 13px; margin-bottom: 5px; display: block;"></label>
                            <textarea id="proactiveness-feedback" style="width: 100%; min-height: 60px; font-size: 13px; padding: 8px; border: 1px solid var(--gray-300); border-radius: 4px;"></textarea>
                        </div>
                    </div>
                </div>

                <div id="total-score-display" class="total-score" style="display: none;">
                    <div class="number" id="total-score-number">0</div>
                    <div class="label">Total Score (out of 12)</div>
                </div>


                <div class="btn-group">
                    <button type="submit" class="btn">Save CRR</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear Form</button>
                </div>
            </form>
        </div>

        <!-- All Reviews View -->
        <div id="all-reviews" class="view">
            <h2>All Customer Response Reviews</h2>
            <div class="filter-bar">
                <select id="filter-agent" onchange="filterReviews()">
                    <option value="">All Agents</option>
                </select>
                <select id="filter-supervisor" onchange="filterReviews()">
                    <option value="">All Supervisors</option>
                </select>
                <select id="filter-type" onchange="filterReviews()">
                    <option value="">All Types</option>
                    <option value="Ticket">Ticket</option>
                    <option value="Chat">Chat</option>
                    <option value="Call">Call</option>
                    <option value="Bot Response">Bot Response</option>
                </select>
                <button class="btn btn-secondary" onclick="showDemoRestriction('export')">Export Data</button>
                <button class="btn btn-secondary" onclick="showDemoRestriction('googleSheets')">Copy to Google Sheets</button>
                <button class="btn btn-secondary" onclick="showDemoRestriction('import')">Import Data</button>
            </div>
            <div id="reviews-table-container"></div>
        </div>

        <!-- Agent Dashboard View -->
        <div id="agent-dashboard" class="view">
            <h2>Agent Dashboard</h2>
            <div class="form-group" style="max-width: 300px;">
                <label for="dashboard-agent">Select Agent</label>
                <select id="dashboard-agent" onchange="updateAgentDashboard()">
                    <option value="">Select Agent...</option>
                </select>
            </div>
            <div id="agent-dashboard-content"></div>
        </div>

        <!-- Team Overview View -->
        <div id="team-overview" class="view">
            <h2>Team Overview</h2>
            <div id="team-overview-content"></div>
        </div>

        <!-- Scoring Guide View -->
        <div id="scoring-guide" class="view">
            <h2>Scoring Guide</h2>
            
            <div class="guide-section">
                <h3>Understanding the 3-Point Scale</h3>
                <table class="scoring-table">
                    <tr>
                        <th>Score</th>
                        <th>Meaning</th>
                        <th>What It Communicates</th>
                    </tr>
                    <tr>
                        <td><span class="score-badge low">1</span></td>
                        <td><strong>Problem</strong></td>
                        <td>Agent should feel nervous. Keep getting 1s and disciplinary action may follow. Not good enough.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge medium">2</span></td>
                        <td><strong>Acceptable</strong></td>
                        <td>No nervousness needed. Keep getting 2s and all is well. It's good enough.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge high">3</span></td>
                        <td><strong>Exemplary</strong></td>
                        <td>Agent should be proud. Keep getting 3s and you're positioning for raises/promotions.</td>
                    </tr>
                </table>
            </div>

            <div class="guide-section">
                <h2>The 4 Core Metrics</h2>

                <h3>1. Expertise</h3>
                <p><em>Question: "Do they demonstrate technical grasp of the problem and surrounding issues to the user?"</em></p>
                <table class="scoring-table">
                    <tr>
                        <td><span class="score-badge low">1</span></td>
                        <td>Agent doesn't demonstrate knowledge of the product or how to solve the issue. User is left uncertain if agent can help.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge medium">2</span></td>
                        <td>Agent shows basic competence. User feels the agent knows the product.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge high">3</span></td>
                        <td>Agent positions themselves as an expert. User is confident the agent is highly knowledgeable AND willing to share that knowledge. Projects confidence even when uncertain.</td>
                    </tr>
                </table>
                <p><strong>Quick Tip:</strong> Confidence is key. Even if not sure of the exact problem, demonstrate confidence that once isolated, it will be fixed.</p>

                <h3>2. Ownership</h3>
                <p><em>Question: "Do they avoid passing off responsibility to others to solve the problem?"</em></p>
                <table class="scoring-table">
                    <tr>
                        <td><span class="score-badge low">1</span></td>
                        <td>Agent passes the buck to other support desks or makes user do the work without proper guidance. User feels abandoned.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge medium">2</span></td>
                        <td>Agent takes basic responsibility for the interaction and follows through.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge high">3</span></td>
                        <td>Agent acts as ambassador navigating between products/support desks. User feels the agent will not stop until problem is resolved.</td>
                    </tr>
                </table>
                <p><strong>Quick Tip:</strong> Goal is resolution, not just "bug reported." Communicate timelines, give workarounds, ensure user has an immediate plan.</p>

                <h3>3. Articulation</h3>
                <p><em>Question: "Do they communicate clearly, with helpful tone, and attention to detail?"</em></p>
                <table class="scoring-table">
                    <tr>
                        <td><span class="score-badge low">1</span></td>
                        <td>Unclear communication, poor tone, or missing details. User is confused or frustrated.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge medium">2</span></td>
                        <td>Clear, professional communication. User understands next steps.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge high">3</span></td>
                        <td>Nails the tone (CREW), pays attention to word choices, asks clarifying questions. User feels they have a wise friend at the company.</td>
                    </tr>
                </table>
                <p><strong>Quick Tip:</strong> Agents aren't robots. Use humor, personalization, and clarity. Small touches matter.</p>

                <h3>4. Proactiveness</h3>
                <p><em>Question: "Do they utilize all opportunities to maximize long-term benefits of this interaction?"</em></p>
                <table class="scoring-table">
                    <tr>
                        <td><span class="score-badge low">1</span></td>
                        <td>Missed opportunity to improve documentation, product, or processes. Only solved immediate problem.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge medium">2</span></td>
                        <td>Solved the problem effectively.</td>
                    </tr>
                    <tr>
                        <td><span class="score-badge high">3</span></td>
                        <td>Found something to make the company/product/documentation better. Prevented others from having the same problem. User feels they're the agent's secret weapon to improve the product.</td>
                    </tr>
                </table>
                <p><strong>Quick Tip:</strong> Every interaction can improve something. Taking 2 extra minutes to thank customer for helping improve the product can turn a refund into a 5-star review.</p>
            </div>

            <div class="guide-section">
                <h2>CREW Tone Framework</h2>
                
                <h3>C - Confident, not Apologetic</h3>
                <p>We are proud of our product and don't apologize for things that are not our fault. Lead with confidence.</p>
                <div class="example-box dont">
                    <strong>❌ Don't Say:</strong> "So sorry you're experiencing this!"
                </div>
                <div class="example-box do">
                    <strong>✅ Do Say:</strong> "I can help with that!"
                </div>
                <p><strong>Apologize for:</strong> Slow response time, team mistakes</p>
                <p><strong>Don't Apologize for:</strong> Bugs, theme conflicts, lack of features, things outside your control</p>

                <h3>R - Results Oriented, not Argumentative</h3>
                <p>Don't respond to frustration with defense. Focus on solving the problem.</p>
                <div class="example-box dont">
                    <strong>❌ Don't Say:</strong> "Actually we're quite competent. I have a degree in..."
                </div>
                <div class="example-box do">
                    <strong>✅ Do Say:</strong> "I'm happy to get to the bottom of this with you. Here are the steps..."
                </div>

                <h3>E - Educational, not Haughty or Overly Technical</h3>
                <p>Explain clearly without jargon. If you can't explain it to a 10-year-old, rewrite it.</p>
                <div class="example-box dont">
                    <strong>❌ Don't Say:</strong> "The jQuery error in the header is throwing a script conflict preventing DOM manipulation"
                </div>
                <div class="example-box do">
                    <strong>✅ Do Say:</strong> "A file loaded by X plugin isn't playing nicely with our file, preventing the form from loading correctly. Here's how to fix it..."
                </div>

                <h3>W - Welcoming, not Thankful</h3>
                <p>Skip generic "thanks for contacting us." Lead with excitement or personalization.</p>
                <div class="example-box dont">
                    <strong>❌ Don't Say:</strong> "Thanks for contacting support"
                </div>
                <div class="example-box do">
                    <strong>✅ Do Say:</strong> "You've come to the right place - we'll get this sorted in no time!"
                </div>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings" class="view">
            <h2>Settings</h2>
            
            <div class="guide-section">
                <h3>Agent Roster</h3>
                <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 15px;">Assign each agent to their supervisor. This will auto-fill when scoring CRRs.</p>
                <div id="agents-list"></div>
                <div class="form-row" style="margin-top: 15px;">
                    <input type="text" id="new-agent-name" placeholder="New agent name" style="flex: 2;">
                    <select id="new-agent-supervisor" style="flex: 1;">
                        <option value="">Select supervisor...</option>
                    </select>
                    <button class="btn" onclick="addAgent()">Add Agent</button>
                </div>
            </div>

            <div class="guide-section">
                <h3>Supervisor List</h3>
                <div id="supervisors-list"></div>
                <div class="form-row" style="margin-top: 15px;">
                    <input type="text" id="new-supervisor-name" placeholder="New supervisor name">
                    <button class="btn" onclick="addSupervisor()">Add Supervisor</button>
                </div>
            </div>

            <div class="guide-section">
                <h3>Data Management</h3>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="showDemoRestriction('export')">Export All Data</button>
                    <button class="btn btn-secondary" onclick="showDemoRestriction('import')">Import Data (JSON)</button>
                    <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
                </div>
            </div>

            <div class="guide-section">
                <h3>Sample Data</h3>
                <p>Load sample CRRs to see how the tool works.</p>
                <button class="btn btn-secondary" onclick="loadSampleData()">Load Sample Data</button>
            </div>
        </div>
    </div>

    <script>
        // Security: Input sanitization functions
        // 🔒 Ooh, look at you trying to reverse engineer this! 
        // 🕵️‍♂️ You're like a digital detective, but without the paycheck! 💸
        // 💡 Pro tip: It's easier to just buy the product than to hack it! 🛒
        // 🎭 But hey, if you're having fun, keep going! Just... maybe buy it too? 😅
        function sanitizeHTML(str) {
            if (typeof str !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function validateInput(input, maxLength = 100) {
            if (typeof input !== 'string') return '';
            // Remove potentially dangerous characters and limit length
            return input.slice(0, maxLength).replace(/[<>'"&]/g, '');
        }

        function safeInnerHTML(element, content) {
            // Use textContent for safety, or sanitize if HTML is needed
            if (typeof content === 'string') {
                element.innerHTML = sanitizeHTML(content);
            } else {
                element.innerHTML = content;
            }
        }

        // Data storage
        // 🕵️ Hey there, curious developer! 👋
        // 👀 I see you're snooping around the source code...
        // 🤔 Maybe you should just buy the full version instead? 💰
        // 🚀 It's only $100 and you get ALL the features!
        // 📧 Contact: ben@buildsustainablesupport.com
        // 🎯 Or just stop being cheap and buy it already! 😏
        let crrData = JSON.parse(localStorage.getItem('crrData')) || [];
        let agents = JSON.parse(localStorage.getItem('agents')) || [];
        let supervisors = JSON.parse(localStorage.getItem('supervisors')) || [];
        // Agent-Supervisor associations: { agentName: supervisorName }
        let agentSupervisors = JSON.parse(localStorage.getItem('agentSupervisors')) || {};

        // Score hints
        const scoreHints = {
            expertise: {
                1: '❌ No demonstration of product knowledge',
                2: '✓ Shows basic competence',
                3: '✅ Positions as expert, projects confidence'
            },
            ownership: {
                1: '❌ Passes buck, user feels abandoned',
                2: '✓ Takes responsibility, follows through',
                3: '✅ Acts as ambassador, won\'t stop until resolved'
            },
            articulation: {
                1: '❌ Unclear, poor tone, missing details',
                2: '✓ Clear, professional communication',
                3: '✅ Nails tone, personalizes, wise friend'
            },
            proactiveness: {
                1: '❌ Missed improvement opportunity',
                2: '✓ Solved problem effectively',
                3: '✅ Improved docs/product/process, prevented future issues'
            }
        };

        // Quick feedback options from the book
        const quickOptions = {
            expertise: {
                1: [
                    { id: 'no-product-knowledge', label: 'Wrong answer', text: 'Gave factually incorrect information' },
                    { id: 'lacked-confidence', label: 'Confused', text: 'Confused about the issue or solution' }
                ],
                3: [
                    { id: 'expert-positioned', label: 'Expert positioning', text: 'Positioned themselves as an expert; user confident in their knowledge' },
                    { id: 'projected-confidence', label: 'Projected confidence', text: 'Projected confidence even when uncertain; assured user issue would be resolved once isolated' }
                ]
            },
            ownership: {
                1: [
                    { id: 'passed-buck', label: 'Passed buck', text: 'Passed the customer to another support desk without proper context or guidance' },
                    { id: 'user-abandoned', label: 'Abandoned user', text: 'User felt abandoned; did not follow through to resolution' }
                ],
                3: [
                    { id: 'ambassador-role', label: 'Ambassador', text: 'Acted as ambassador between products/teams; navigated conflict for the user' },
                    { id: 'workarounds-timeline', label: 'Workarounds + timeline', text: 'Provided workarounds and clear timeline; communicated plan even before full resolution' }
                ]
            },
            articulation: {
                1: [
                    { id: 'unclear-communication', label: 'Unclear', text: 'Unclear communication or confusing explanations; user left uncertain' },
                    { id: 'technical-jargon', label: 'Too technical', text: 'Used excessive technical jargon; did not explain in terms user could understand' },
                    { id: 'led-with-apology', label: 'Led with apology', text: 'Led with apologies instead of confidence; set wrong tone from the start' }
                ],
                3: [
                    { id: 'perfect-tone', label: 'Perfect tone', text: 'Perfect tone - confident, results-oriented, educational, and welcoming' },
                    { id: 'personalized-clear', label: 'Personalized', text: 'Personalized response with clear explanations; user felt they had a wise friend' },
                    { id: 'humor-warmth', label: 'Humor/warmth', text: 'Used appropriate humor and warmth; made technical simple without being condescending' }
                ]
            },
            proactiveness: {
                1: [
                    { id: 'missed-doc-opportunity', label: 'Docs', text: 'Missed opportunity to improve or suggest documentation updates' },
                    { id: 'only-solved-immediate', label: 'Happy, no review', text: 'The user was happy, but we didn\'t ask for a review' }
                ],
                3: [
                    { id: 'improved-docs', label: 'Docs', text: 'Improved documentation and linked to it.' },
                    { id: 'escalated-issue', label: 'Asked for review', text: 'Asked for a review' },
                    { id: 'prevented-future', label: 'Internal convo', text: 'Advocated for the user to the product team.' }
                ]
            }
        };

        // Initialize app
// 🔍 Found another easter egg! You're persistent, I'll give you that! 👏
        function init() {
            // Set today's date
            document.getElementById('review-date').valueAsDate = new Date();
            
            // Populate dropdowns
            updateDropdowns();
            updateSettingsLists();
            
            // Prompt for sample data if no data exists
            if (crrData.length === 0 && !localStorage.getItem('initialSetupComplete')) {
                setTimeout(() => {
                    showWelcomeDialog();
                }, 500);
            }
        }
        
        // Auto-fill supervisor when agent is selected
        function autoFillSupervisor() {
            const agentName = document.getElementById('agent-name').value;
            const supervisorSelect = document.getElementById('supervisor-name');
            
            if (agentName && agentSupervisors[agentName]) {
                supervisorSelect.value = agentSupervisors[agentName];
            }
        }
        
        // Welcome dialog for first-time users
        function showWelcomeDialog() {
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            dialog.innerHTML = `
                <div style="
                    background: white;
                    padding: 40px;
                    border-radius: 12px;
                    max-width: 500px;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                ">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 20px;">
                        <img src="SS_logo.png" alt="Sustainable Support Logo" style="height: 35px; width: auto; border-radius: 4px;">
                        <h2 style="margin: 0; color: var(--primary);">Welcome to CRR Scoring Tool!</h2>
                    </div>
                    <p style="line-height: 1.6; color: var(--gray-800);">
                        This is your first time using the tool. Would you like to:
                    </p>
                    <div style="margin: 30px 0;">
                        <button id="load-sample-btn" class="btn" style="width: 100%; margin-bottom: 15px; padding: 15px; font-size: 16px;">
                            📊 Load Sample Data
                        </button>
                        <p style="font-size: 14px; color: var(--gray-600); margin: 10px 0;">
                            See sample scored CRRs to understand how the tool works
                        </p>
                        
                        <button id="start-blank-btn" class="btn btn-secondary" style="width: 100%; padding: 15px; font-size: 16px;">
                            ✨ Start with Blank Slate
                        </button>
                        <p style="font-size: 14px; color: var(--gray-600); margin: 10px 0 0 0;">
                            Begin fresh - add your agents and start scoring
                        </p>
                    </div>
                    <p style="font-size: 13px; color: var(--gray-600); margin-bottom: 0;">
                        💡 You can always load sample data later from Settings
                    </p>
                </div>
            `;
            
            document.body.appendChild(dialog);
            
            document.getElementById('load-sample-btn').onclick = () => {
                loadSampleData();
                localStorage.setItem('initialSetupComplete', 'true');
                document.body.removeChild(dialog);
            };
            
            document.getElementById('start-blank-btn').onclick = () => {
                localStorage.setItem('initialSetupComplete', 'true');
                document.body.removeChild(dialog);
                // Show Settings view and helpful tip
                setTimeout(() => {
                    showView('settings');
                    alert('👋 Welcome! First, add your agents and supervisors using the fields below. Then you can start scoring CRRs!');
                }, 300);
            };
        }

        // Update all dropdowns
        function updateDropdowns() {
            const agentSelects = ['agent-name', 'filter-agent', 'dashboard-agent'];
            const supervisorSelects = ['supervisor-name', 'filter-supervisor'];
            
            agentSelects.forEach(id => {
                const select = document.getElementById(id);
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Agent...</option>' + 
                    agents.map(a => `<option value="${a}">${a}</option>`).join('');
                if (currentValue && agents.includes(currentValue)) {
                    select.value = currentValue;
                }
            });
            
            supervisorSelects.forEach(id => {
                const select = document.getElementById(id);
                const currentValue = select.value;
                select.innerHTML = '<option value="">Select Supervisor...</option>' + 
                    supervisors.map(s => `<option value="${s}">${s}</option>`).join('');
                if (currentValue && supervisors.includes(currentValue)) {
                    select.value = currentValue;
                }
            });
        }

        // Select score button
        function selectScore(metric, score) {
            // Get the metric card container
            const metricCard = document.querySelector(`#${metric}-score`).closest('.metric-card');
            
            // Remove selected class from all buttons in this metric only
            const buttons = metricCard.querySelectorAll('.score-btn');
            buttons.forEach(btn => btn.classList.remove('selected'));
            
            // Add selected class to the button with the matching score in this metric only
            const targetButton = metricCard.querySelector(`.score-btn.score-${score}`);
            if (targetButton) {
                targetButton.classList.add('selected');
            }
            
            // Update hidden input
            document.getElementById(`${metric}-score`).value = score;
            
            // Update hint
            document.getElementById(`${metric}-hint`).textContent = scoreHints[metric][score];
            
            // Show/hide and configure feedback field
            const feedbackContainer = document.getElementById(`${metric}-feedback-container`);
            const feedbackTextarea = document.getElementById(`${metric}-feedback`);
            const feedbackLabel = document.getElementById(`${metric}-feedback-label`);
            const quickOptionsContainer = document.getElementById(`${metric}-quick-options`);
            
            // Clear textarea when switching scores
            feedbackTextarea.value = '';
            
            if (score === 1 || score === 3) {
                // Score of 1 or 3: Required feedback with quick options
                feedbackContainer.style.display = 'block';
                feedbackTextarea.required = true;
                
                if (score === 1) {
                    feedbackLabel.textContent = '❌ Why is this a 1? (Required)';
                    feedbackLabel.style.color = 'var(--danger)';
                } else {
                    feedbackLabel.textContent = '✅ Why is this a 3? (Required)';
                    feedbackLabel.style.color = 'var(--success)';
                }
                feedbackLabel.style.fontWeight = '600';
                feedbackTextarea.placeholder = 'Select from quick options above, or write your own...';
                
                // Clear and populate quick options
                populateQuickOptions(metric, score);
                quickOptionsContainer.style.display = 'block';
                
            } else if (score === 2) {
                // Score of 2: Optional feedback, no quick options
                feedbackContainer.style.display = 'block';
                feedbackTextarea.required = false;
                feedbackLabel.textContent = 'Notes (Optional)';
                feedbackLabel.style.color = 'var(--gray-800)';
                feedbackLabel.style.fontWeight = '500';
                feedbackTextarea.placeholder = 'Any additional notes...';
                quickOptionsContainer.style.display = 'none';
                
                // Clear any checkboxes
                quickOptionsContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
            
            // Update total score
            updateTotalScore();
        }
        
        // Populate quick feedback options
        function populateQuickOptions(metric, score) {
            const container = document.getElementById(`${metric}-quick-options`);
            const options = quickOptions[metric][score] || [];
            
            // Clear existing checkboxes (keep the label)
            const label = container.querySelector('p');
            container.innerHTML = '';
            container.appendChild(label);
            
            // Add checkboxes for each option
            options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'quick-option';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `${metric}-${option.id}`;
                checkbox.onchange = () => updateFeedbackFromCheckboxes(metric);
                
                const checkboxLabel = document.createElement('label');
                checkboxLabel.htmlFor = checkbox.id;
                checkboxLabel.textContent = option.label; // Use short label
                
                optionDiv.appendChild(checkbox);
                optionDiv.appendChild(checkboxLabel);
                container.appendChild(optionDiv);
            });
        }
        
        // Update feedback textarea from selected checkboxes
        function updateFeedbackFromCheckboxes(metric) {
            const score = parseInt(document.getElementById(`${metric}-score`).value);
            const options = quickOptions[metric][score] || [];
            const textarea = document.getElementById(`${metric}-feedback`);
            
            // Get all checked options
            const selectedTexts = [];
            options.forEach(option => {
                const checkbox = document.getElementById(`${metric}-${option.id}`);
                if (checkbox && checkbox.checked) {
                    selectedTexts.push(option.text);
                }
            });
            
            // Update textarea - if any checkboxes are selected, join with semicolons
            if (selectedTexts.length > 0) {
                textarea.value = selectedTexts.join('; ');
                // If all options are selected, textarea is filled so it's valid
                if (selectedTexts.length > 0) {
                    textarea.required = false; // Checkboxes satisfy the requirement
                }
            } else {
                textarea.value = '';
                textarea.required = true; // Need to write something if no checkboxes
            }
        }

        // Update total score display
        function updateTotalScore() {
            const expertise = parseInt(document.getElementById('expertise-score').value) || 0;
            const ownership = parseInt(document.getElementById('ownership-score').value) || 0;
            const articulation = parseInt(document.getElementById('articulation-score').value) || 0;
            const proactiveness = parseInt(document.getElementById('proactiveness-score').value) || 0;
            
            const total = expertise + ownership + articulation + proactiveness;
            
            if (total > 0) {
                document.getElementById('total-score-display').style.display = 'block';
                document.getElementById('total-score-number').textContent = total;
            }
        }

        // Save CRR
        function saveCRR(event) {
            event.preventDefault();
            
            // SECURITY: Validate and sanitize all CRR data
            const crr = {
                id: Date.now(),
                date: validateInput(document.getElementById('review-date').value, 20),
                agentName: validateInput(document.getElementById('agent-name').value, 50),
                supervisor: validateInput(document.getElementById('supervisor-name').value, 50),
                interactionType: validateInput(document.getElementById('interaction-type').value, 20),
                interactionLink: validateInput(document.getElementById('interaction-link').value, 200),
                expertise: parseInt(document.getElementById('expertise-score').value) || 0,
                ownership: parseInt(document.getElementById('ownership-score').value) || 0,
                articulation: parseInt(document.getElementById('articulation-score').value) || 0,
                proactiveness: parseInt(document.getElementById('proactiveness-score').value) || 0,
                totalScore: parseInt(document.getElementById('expertise-score').value) + 
                           parseInt(document.getElementById('ownership-score').value) + 
                           parseInt(document.getElementById('articulation-score').value) + 
                           parseInt(document.getElementById('proactiveness-score').value),
                expertiseFeedback: validateInput(document.getElementById('expertise-feedback').value, 500),
                ownershipFeedback: validateInput(document.getElementById('ownership-feedback').value, 500),
                articulationFeedback: validateInput(document.getElementById('articulation-feedback').value, 500),
                proactivenessFeedback: validateInput(document.getElementById('proactiveness-feedback').value, 500)
            };
            
            crrData.unshift(crr);
            localStorage.setItem('crrData', JSON.stringify(crrData));
            
            resetForm();
            showView('all-reviews');
            showCRRSavedModal();
        }

        // Reset form
// 🕵️‍♂️ Still reading the code? You must really want this product! 🎯
        function resetForm() {
            document.getElementById('crr-form').reset();
            document.getElementById('review-date').valueAsDate = new Date();
            
            // Clear selected states for all metrics
            ['expertise', 'ownership', 'articulation', 'proactiveness'].forEach(metric => {
                const metricContainer = document.getElementById(`${metric}-score`).parentElement.parentElement;
                const buttons = metricContainer.querySelectorAll('.score-btn');
                buttons.forEach(btn => btn.classList.remove('selected'));
            });
            
            document.querySelectorAll('.score-hint').forEach(hint => hint.textContent = 'Select a score');
            document.getElementById('total-score-display').style.display = 'none';
            
            // Hide all feedback containers and clear checkboxes
            ['expertise', 'ownership', 'articulation', 'proactiveness'].forEach(metric => {
                const container = document.getElementById(`${metric}-feedback-container`);
                const textarea = document.getElementById(`${metric}-feedback`);
                const quickOptions = document.getElementById(`${metric}-quick-options`);
                
                container.style.display = 'none';
                textarea.value = '';
                textarea.required = false;
                quickOptions.style.display = 'none';
                
                // Uncheck all checkboxes
                quickOptions.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            });
        }

        // Show view
        function showView(viewId, buttonElement) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(viewId).classList.add('active');
            
            // Highlight the nav button if called from button click
            if (buttonElement) {
                buttonElement.classList.add('active');
            } else {
                // Find and highlight the correct nav button when called programmatically
                const viewToButtonText = {
                    'score-entry': 'New CRR',
                    'all-reviews': 'All Reviews',
                    'agent-dashboard': 'Agent Dashboard',
                    'team-overview': 'Team Overview',
                    'scoring-guide': 'Scoring Guide',
                    'settings': 'Settings'
                };
                const buttons = document.querySelectorAll('.nav-btn');
                buttons.forEach(btn => {
                    if (btn.textContent.trim() === viewToButtonText[viewId]) {
                        btn.classList.add('active');
                    }
                });
            }
            
            // Refresh data when switching views
            if (viewId === 'all-reviews') renderReviewsTable();
            if (viewId === 'team-overview') renderTeamOverview();
        }

        // Render reviews table
        function renderReviewsTable() {
            const container = document.getElementById('reviews-table-container');
            
            let filteredData = [...crrData];
            
            const agentFilter = document.getElementById('filter-agent').value;
            const supervisorFilter = document.getElementById('filter-supervisor').value;
            const typeFilter = document.getElementById('filter-type').value;
            
            if (agentFilter) filteredData = filteredData.filter(r => r.agentName === agentFilter);
            if (supervisorFilter) filteredData = filteredData.filter(r => r.supervisor === supervisorFilter);
            if (typeFilter) filteredData = filteredData.filter(r => r.interactionType === typeFilter);
            
            if (filteredData.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No reviews found</h3><p>Start by creating your first CRR!</p></div>';
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Agent</th>
                            <th>Supervisor</th>
                            <th>Type</th>
                            <th>Link</th>
                            <th>Expertise</th>
                            <th>Ownership</th>
                            <th>Articulation</th>
                            <th>Proactiveness</th>
                            <th>Total</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredData.forEach((crr, index) => {
                const scoreClass = crr.totalScore >= 10 ? 'high' : crr.totalScore >= 7 ? 'medium' : 'low';
                // Handle backward compatibility with old interactionId field
                const link = crr.interactionLink || crr.interactionId || '#';
                const linkDisplay = crr.interactionLink ? '🔗 View' : (crr.interactionId || 'N/A');
                
                html += `
                    <tr>
                        <td>${new Date(crr.date).toLocaleDateString()}</td>
                        <td>${crr.agentName}</td>
                        <td>${crr.supervisor}</td>
                        <td>${crr.interactionType}</td>
                        <td>${crr.interactionLink ? `<a href="${link}" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none;">${linkDisplay}</a>` : linkDisplay}</td>
                        <td><span class="score-badge ${crr.expertise === 3 ? 'high' : crr.expertise === 1 ? 'low' : 'medium'}">${crr.expertise}</span></td>
                        <td><span class="score-badge ${crr.ownership === 3 ? 'high' : crr.ownership === 1 ? 'low' : 'medium'}">${crr.ownership}</span></td>
                        <td><span class="score-badge ${crr.articulation === 3 ? 'high' : crr.articulation === 1 ? 'low' : 'medium'}">${crr.articulation}</span></td>
                        <td><span class="score-badge ${crr.proactiveness === 3 ? 'high' : crr.proactiveness === 1 ? 'low' : 'medium'}">${crr.proactiveness}</span></td>
                        <td><span class="score-badge ${scoreClass}">${crr.totalScore}/12</span></td>
                        <td><button class="btn" style="padding: 5px 12px; font-size: 12px;" onclick="showCRRDetails(${index})">View</button></td>
                    </tr>
                    <tr id="details-${index}" style="display: none;">
                        <td colspan="11" style="background: var(--gray-50); padding: 20px;">
                            <h4 style="margin-top: 0; color: var(--primary);">Feedback Details</h4>
                            ${crr.expertiseFeedback ? `<p><strong>Expertise (${crr.expertise}):</strong> ${crr.expertiseFeedback}</p>` : ''}
                            ${crr.ownershipFeedback ? `<p><strong>Ownership (${crr.ownership}):</strong> ${crr.ownershipFeedback}</p>` : ''}
                            ${crr.articulationFeedback ? `<p><strong>Articulation (${crr.articulation}):</strong> ${crr.articulationFeedback}</p>` : ''}
                            ${crr.proactivenessFeedback ? `<p><strong>Proactiveness (${crr.proactiveness}):</strong> ${crr.proactivenessFeedback}</p>` : ''}
                            ${!crr.expertiseFeedback && !crr.ownershipFeedback && !crr.articulationFeedback && !crr.proactivenessFeedback ? '<p style="color: var(--gray-600);">No feedback provided for this review.</p>' : ''}
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Filter reviews
// 🎪 Welcome to the code circus! Where everything costs money! 🎭
        function filterReviews() {
            renderReviewsTable();
        }
        
        // Show/hide CRR details
        function showCRRDetails(index) {
            const detailsRow = document.getElementById(`details-${index}`);
            if (detailsRow.style.display === 'none') {
                detailsRow.style.display = 'table-row';
            } else {
                detailsRow.style.display = 'none';
            }
        }

        // Update agent dashboard
        function updateAgentDashboard() {
            const agentName = document.getElementById('dashboard-agent').value;
            const container = document.getElementById('agent-dashboard-content');
            
            if (!agentName) {
                container.innerHTML = '<div class="empty-state"><p>Select an agent to view their dashboard</p></div>';
                return;
            }
            
            const agentReviews = crrData.filter(r => r.agentName === agentName);
            
            if (agentReviews.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No reviews yet</h3><p>This agent hasn\'t been reviewed yet.</p></div>';
                return;
            }
            
            // Calculate stats
            const avgTotal = (agentReviews.reduce((sum, r) => sum + r.totalScore, 0) / agentReviews.length).toFixed(1);
            const avgExpertise = (agentReviews.reduce((sum, r) => sum + r.expertise, 0) / agentReviews.length).toFixed(1);
            const avgOwnership = (agentReviews.reduce((sum, r) => sum + r.ownership, 0) / agentReviews.length).toFixed(1);
            const avgArticulation = (agentReviews.reduce((sum, r) => sum + r.articulation, 0) / agentReviews.length).toFixed(1);
            const avgProactiveness = (agentReviews.reduce((sum, r) => sum + r.proactiveness, 0) / agentReviews.length).toFixed(1);
            
            const threes = agentReviews.reduce((sum, r) => sum + [r.expertise, r.ownership, r.articulation, r.proactiveness].filter(s => s === 3).length, 0);
            const twos = agentReviews.reduce((sum, r) => sum + [r.expertise, r.ownership, r.articulation, r.proactiveness].filter(s => s === 2).length, 0);
            const ones = agentReviews.reduce((sum, r) => sum + [r.expertise, r.ownership, r.articulation, r.proactiveness].filter(s => s === 1).length, 0);
            
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="value">${avgTotal}</div>
                        <div class="label">Avg Total Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${avgExpertise}</div>
                        <div class="label">Avg Expertise</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${avgOwnership}</div>
                        <div class="label">Avg Ownership</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${avgArticulation}</div>
                        <div class="label">Avg Articulation</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${avgProactiveness}</div>
                        <div class="label">Avg Proactiveness</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${agentReviews.length}</div>
                        <div class="label">Total CRRs</div>
                    </div>
                </div>
                
                <h3 style="margin-top: 30px;">Score Trends</h3>
                <div class="chart-container">
                    <canvas id="agent-trend-chart"></canvas>
                </div>
                
                <h3>Metric Breakdown</h3>
                <div class="chart-container">
                    <canvas id="agent-metrics-chart"></canvas>
                </div>
            `;
            
            // Check for red flags
            const redFlags = checkRedFlags(agentName);
            if (redFlags.length > 0) {
                html = `<div class="alert alert-warning">
                    <strong>⚠️ Red Flags Detected:</strong><br>
                    ${redFlags.join('<br>')}
                </div>` + html;
            }
            
            container.innerHTML = html;
            
            // Draw charts
            drawAgentTrendChart(agentReviews);
            drawAgentMetricsChart([avgExpertise, avgOwnership, avgArticulation, avgProactiveness]);
        }

        // Check for red flags
        function checkRedFlags(agentName) {
            const agentReviews = crrData.filter(r => r.agentName === agentName).slice(0, 5);
            const flags = [];
            
            const metrics = ['expertise', 'ownership', 'articulation', 'proactiveness'];
            metrics.forEach(metric => {
                const ones = agentReviews.filter(r => r[metric] === 1).length;
                if (ones >= 3) {
                    flags.push(`🚩 Multiple scores of 1 on ${metric.charAt(0).toUpperCase() + metric.slice(1)} in recent reviews`);
                }
            });
            
            return flags;
        }

        // Draw agent trend chart
        function drawAgentTrendChart(reviews) {
            const ctx = document.getElementById('agent-trend-chart');
            if (!ctx) return;
            
            const sortedReviews = [...reviews].reverse();
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedReviews.map(r => new Date(r.date).toLocaleDateString()),
                    datasets: [{
                        label: 'Total Score',
                        data: sortedReviews.map(r => r.totalScore),
                        borderColor: '#1a237e',
                        backgroundColor: 'rgba(26, 35, 126, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 12,
                            title: {
                                display: true,
                                text: 'Score (out of 12)'
                            }
                        }
                    }
                }
            });
        }

        // Draw agent metrics chart
        function drawAgentMetricsChart(averages) {
            const ctx = document.getElementById('agent-metrics-chart');
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Expertise', 'Ownership', 'Articulation', 'Proactiveness'],
                    datasets: [{
                        label: 'Average Score',
                        data: averages,
                        backgroundColor: ['#1a237e', '#3949ab', '#5c6bc0', '#7986cb']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 3,
                            title: {
                                display: true,
                                text: 'Average Score'
                            }
                        }
                    }
                }
            });
        }

        // Render team overview
        function renderTeamOverview() {
            const container = document.getElementById('team-overview-content');
            
            if (crrData.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No data yet</h3><p>Start conducting CRRs to see team analytics.</p></div>';
                return;
            }
            
            // Calculate team stats
            const avgTeamScore = (crrData.reduce((sum, r) => sum + r.totalScore, 0) / crrData.length).toFixed(1);
            const uniqueAgents = [...new Set(crrData.map(r => r.agentName))];
            const thisWeek = crrData.filter(r => {
                const reviewDate = new Date(r.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return reviewDate >= weekAgo;
            }).length;
            
            let html = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="value">${avgTeamScore}</div>
                        <div class="label">Team Avg Score</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${crrData.length}</div>
                        <div class="label">Total CRRs</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${thisWeek}</div>
                        <div class="label">This Week</div>
                    </div>
                    <div class="stat-card">
                        <div class="value">${uniqueAgents.length}</div>
                        <div class="label">Agents Reviewed</div>
                    </div>
                </div>
                
                <h3>Agent Comparison</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Agent Name</th>
                            <th>Avg Total</th>
                            <th>Avg Expertise</th>
                            <th>Avg Ownership</th>
                            <th>Avg Articulation</th>
                            <th>Avg Proactiveness</th>
                            <th># Reviews</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            uniqueAgents.forEach(agent => {
                const agentReviews = crrData.filter(r => r.agentName === agent);
                const avgTotal = (agentReviews.reduce((sum, r) => sum + r.totalScore, 0) / agentReviews.length).toFixed(1);
                const avgExpertise = (agentReviews.reduce((sum, r) => sum + r.expertise, 0) / agentReviews.length).toFixed(1);
                const avgOwnership = (agentReviews.reduce((sum, r) => sum + r.ownership, 0) / agentReviews.length).toFixed(1);
                const avgArticulation = (agentReviews.reduce((sum, r) => sum + r.articulation, 0) / agentReviews.length).toFixed(1);
                const avgProactiveness = (agentReviews.reduce((sum, r) => sum + r.proactiveness, 0) / agentReviews.length).toFixed(1);
                
                // Total score: just darker/lighter (no color)
                const totalScoreClass = avgTotal >= 10 ? 'total-high' : avgTotal >= 7 ? 'total-medium' : 'total-low';
                
                // Individual metrics: red to green progression
                const getMetricClass = (score) => {
                    if (score >= 2.5) return 'metric-excellent';
                    if (score >= 2.0) return 'metric-good';
                    if (score >= 1.5) return 'metric-warning';
                    return 'metric-danger';
                };
                
                html += `
                    <tr>
                        <td><strong>${agent}</strong></td>
                        <td><span class="score-badge ${totalScoreClass}">${avgTotal}</span></td>
                        <td><span class="score-badge ${getMetricClass(avgExpertise)}">${avgExpertise}</span></td>
                        <td><span class="score-badge ${getMetricClass(avgOwnership)}">${avgOwnership}</span></td>
                        <td><span class="score-badge ${getMetricClass(avgArticulation)}">${avgArticulation}</span></td>
                        <td><span class="score-badge ${getMetricClass(avgProactiveness)}">${avgProactiveness}</span></td>
                        <td>${agentReviews.length}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                
                <h3 style="margin-top: 30px;">Team Score Trends</h3>
                <div class="chart-container">
                    <canvas id="team-trend-chart"></canvas>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Draw team trend chart
            drawTeamTrendChart();
        }

        // Draw team trend chart
        function drawTeamTrendChart() {
            const ctx = document.getElementById('team-trend-chart');
            if (!ctx) return;
            
            const sortedReviews = [...crrData].reverse();
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedReviews.map(r => new Date(r.date).toLocaleDateString()),
                    datasets: [{
                        label: 'Total Score',
                        data: sortedReviews.map(r => r.totalScore),
                        borderColor: '#1a237e',
                        backgroundColor: 'rgba(26, 35, 126, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 12
                        }
                    }
                }
            });
        }

        // Update settings lists
        function updateSettingsLists() {
            const agentsList = document.getElementById('agents-list');
            const supervisorsList = document.getElementById('supervisors-list');
            
            // Update agent list with supervisor assignments (SECURITY: Safe HTML generation)
            agentsList.innerHTML = '';
            agents.forEach((agent, i) => {
                const agentDiv = document.createElement('div');
                agentDiv.style.cssText = 'padding: 10px; background: var(--gray-50); margin-bottom: 5px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; gap: 10px;';
                
                // Agent name (safe)
                const agentSpan = document.createElement('span');
                agentSpan.style.cssText = 'font-weight: 500; min-width: 120px; flex-shrink: 0;';
                agentSpan.textContent = validateInput(agent, 50);
                
                // Supervisor select (safe)
                const supervisorSelect = document.createElement('select');
                supervisorSelect.style.cssText = 'margin-right: 10px; padding: 5px; font-size: 13px; min-width: 150px; max-width: 200px; flex: 1;';
                supervisorSelect.onchange = () => updateAgentSupervisor(agent, supervisorSelect.value);
                
                const noSupervisorOption = document.createElement('option');
                noSupervisorOption.value = '';
                noSupervisorOption.textContent = 'No supervisor';
                supervisorSelect.appendChild(noSupervisorOption);
                
                supervisors.forEach(supervisor => {
                    const option = document.createElement('option');
                    option.value = validateInput(supervisor, 50);
                    option.textContent = validateInput(supervisor, 50);
                    if (agentSupervisors[agent] === supervisor) {
                        option.selected = true;
                    }
                    supervisorSelect.appendChild(option);
                });
                
                // Remove button (safe)
                const removeButton = document.createElement('button');
                removeButton.className = 'btn btn-danger';
                removeButton.style.cssText = 'padding: 5px 10px; font-size: 12px; flex-shrink: 0;';
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeAgent(i);
                
                agentDiv.appendChild(agentSpan);
                agentDiv.appendChild(supervisorSelect);
                agentDiv.appendChild(removeButton);
                agentsList.appendChild(agentDiv);
            });
            
            // Update supervisors list (SECURITY: Safe HTML generation)
            supervisorsList.innerHTML = '';
            supervisors.forEach((supervisor, i) => {
                const supervisorDiv = document.createElement('div');
                supervisorDiv.style.cssText = 'padding: 10px; background: var(--gray-50); margin-bottom: 5px; border-radius: 4px; display: flex; justify-content: space-between;';
                
                const supervisorSpan = document.createElement('span');
                supervisorSpan.textContent = validateInput(supervisor, 50);
                
                const removeButton = document.createElement('button');
                removeButton.className = 'btn btn-danger';
                removeButton.style.cssText = 'padding: 5px 10px; font-size: 12px;';
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeSupervisor(i);
                
                supervisorDiv.appendChild(supervisorSpan);
                supervisorDiv.appendChild(removeButton);
                supervisorsList.appendChild(supervisorDiv);
            });
            
            // Update the new agent supervisor dropdown (SECURITY: Safe HTML generation)
            const newAgentSupervisor = document.getElementById('new-agent-supervisor');
            if (newAgentSupervisor) {
                newAgentSupervisor.innerHTML = '';
                
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'Select supervisor...';
                newAgentSupervisor.appendChild(defaultOption);
                
                supervisors.forEach(supervisor => {
                    const option = document.createElement('option');
                    option.value = validateInput(supervisor, 50);
                    option.textContent = validateInput(supervisor, 50);
                    newAgentSupervisor.appendChild(option);
                });
            }
        }
        
        // Update agent-supervisor association
        function updateAgentSupervisor(agentName, supervisorName) {
            if (supervisorName) {
                agentSupervisors[agentName] = supervisorName;
            } else {
                delete agentSupervisors[agentName];
            }
            localStorage.setItem('agentSupervisors', JSON.stringify(agentSupervisors));
        }

        // Add agent (SECURITY: Input validation)
        function addAgent() {
            const name = validateInput(document.getElementById('new-agent-name').value.trim(), 50);
            const supervisor = validateInput(document.getElementById('new-agent-supervisor').value, 50);
            
            if (!name) return alert('Please enter a name');
            if (name.length < 2) return alert('Name must be at least 2 characters');
            if (agents.includes(name)) return alert('Agent already exists');
            
            agents.push(name);
            localStorage.setItem('agents', JSON.stringify(agents));
            
            // Associate with supervisor if selected
            if (supervisor) {
                agentSupervisors[name] = supervisor;
                localStorage.setItem('agentSupervisors', JSON.stringify(agentSupervisors));
            }
            
            document.getElementById('new-agent-name').value = '';
            document.getElementById('new-agent-supervisor').value = '';
            updateDropdowns();
            updateSettingsLists();
        }

        // Remove agent
        function removeAgent(index) {
            if (confirm('Remove this agent? Their reviews will remain in the system.')) {
                const agentName = agents[index];
                agents.splice(index, 1);
                localStorage.setItem('agents', JSON.stringify(agents));
                
                // Remove supervisor association
                delete agentSupervisors[agentName];
                localStorage.setItem('agentSupervisors', JSON.stringify(agentSupervisors));
                
                updateDropdowns();
                updateSettingsLists();
            }
        }

        // Add supervisor (SECURITY: Input validation)
        function addSupervisor() {
            const name = validateInput(document.getElementById('new-supervisor-name').value.trim(), 50);
            if (!name) return alert('Please enter a name');
            if (name.length < 2) return alert('Name must be at least 2 characters');
            if (supervisors.includes(name)) return alert('Supervisor already exists');
            
            supervisors.push(name);
            localStorage.setItem('supervisors', JSON.stringify(supervisors));
            document.getElementById('new-supervisor-name').value = '';
            updateDropdowns();
            updateSettingsLists();
        }

        // Remove supervisor
        function removeSupervisor(index) {
            if (confirm('Remove this supervisor? Their reviews will remain in the system.')) {
                supervisors.splice(index, 1);
                localStorage.setItem('supervisors', JSON.stringify(supervisors));
                updateDropdowns();
                updateSettingsLists();
            }
        }

        // Show Google Sheets copy options dialog
        function showGoogleSheetsCopyOptions() {
            const dialog = document.createElement('div');
            dialog.className = 'google-sheets-dialog';
            dialog.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 1000;
            `;
            
            dialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%;">
                    <h3 style="margin: 0 0 20px 0; color: var(--gray-800);">Copy to Google Sheets</h3>
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: flex-start; margin-bottom: 10px; cursor: pointer; padding: 12px; background: var(--gray-50); border-radius: 6px; border: 1px solid var(--gray-200); transition: all 0.2s ease;">
                            <input type="checkbox" id="include-headers" checked style="
                                margin-right: 12px; 
                                margin-top: 2px;
                                width: 18px; 
                                height: 18px; 
                                accent-color: var(--primary);
                                cursor: pointer;
                                flex-shrink: 0;
                            ">
                            <div style="flex: 1;">
                                <span style="font-weight: 500; color: var(--gray-800); display: block; margin-bottom: 4px;">Include header row</span>
                                <p style="font-size: 13px; color: var(--gray-600); margin: 0; line-height: 1.4;">
                                    Recommended for new spreadsheets. Uncheck if pasting into existing spreadsheet with headers.
                                </p>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: var(--gray-700);">How to paste:</h4>
                        <ol style="margin: 0 0 10px 0; color: var(--gray-600); font-size: 14px; padding-left: 20px;">
                            <li>Click "Copy Data" below</li>
                            <li>Open Google Sheets (new or existing)</li>
                            <li>Click in the cell where you want to start</li>
                            <li>Paste (Ctrl+V or Cmd+V)</li>
                        </ol>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button onclick="copyToGoogleSheets()" 
                                style="padding: 8px 16px; background: var(--success); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Copy Data
                        </button>
                        <button onclick="openGoogleSheets()" 
                                style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Create New Google Sheet
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="close-dialog-btn" 
                                style="padding: 8px 16px; border: 1px solid var(--gray-300); background: white; border-radius: 4px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            // Add click handler to close button
            dialog.querySelector('.close-dialog-btn').addEventListener('click', function() {
                dialog.remove();
            });
            
            // Also allow clicking on overlay to close
            dialog.addEventListener('click', function(e) {
                if (e.target === dialog) {
                    dialog.remove();
                }
            });
            
            document.body.appendChild(dialog);
        }

        // Show export options dialog
        function showExportOptions(context = 'reviews') {
            const dialog = document.createElement('div');
            dialog.className = 'export-options-dialog';
            dialog.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 1000;
            `;
            
            dialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">
                    <h3 style="margin: 0 0 20px 0; color: var(--gray-800);">Export Data</h3>
                    <p style="margin: 0 0 20px 0; color: var(--gray-600);">Choose export format:</p>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: flex-start; margin-bottom: 12px; cursor: pointer; padding: 12px; background: var(--gray-50); border-radius: 6px; border: 1px solid var(--gray-200); transition: all 0.2s ease;">
                            <input type="radio" name="export-format" value="csv" checked style="
                                margin-right: 12px; 
                                margin-top: 2px;
                                width: 18px; 
                                height: 18px; 
                                accent-color: var(--primary);
                                cursor: pointer;
                                flex-shrink: 0;
                            ">
                            <div style="flex: 1;">
                                <span style="font-weight: 500; color: var(--gray-800); display: block; margin-bottom: 4px;">CSV Format</span>
                                <p style="font-size: 13px; color: var(--gray-600); margin: 0; line-height: 1.4;">
                                    Excel/Google Sheets compatible. Perfect for data analysis and sharing.
                                </p>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: flex-start; margin-bottom: 12px; cursor: pointer; padding: 12px; background: var(--gray-50); border-radius: 6px; border: 1px solid var(--gray-200); transition: all 0.2s ease;">
                            <input type="radio" name="export-format" value="json" style="
                                margin-right: 12px; 
                                margin-top: 2px;
                                width: 18px; 
                                height: 18px; 
                                accent-color: var(--primary);
                                cursor: pointer;
                                flex-shrink: 0;
                            ">
                            <div style="flex: 1;">
                                <span style="font-weight: 500; color: var(--gray-800); display: block; margin-bottom: 4px;">JSON Format</span>
                                <p style="font-size: 13px; color: var(--gray-600); margin: 0; line-height: 1.4;">
                                    Complete data backup. Includes all settings, agents, and CRR data.
                                </p>
                            </div>
                        </label>
                    </div>
                    
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="cancel-export-btn" 
                                style="padding: 8px 16px; border: 1px solid var(--gray-300); background: white; border-radius: 4px; cursor: pointer;">
                            Cancel
                        </button>
                        <button onclick="handleExport('${context}')" 
                                style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Export
                        </button>
                    </div>
                </div>
            `;
            
            // Add click handler to cancel button
// 🔍 Found another easter egg! You're persistent, I'll give you that! 👏
            dialog.querySelector('.cancel-export-btn').addEventListener('click', function() {
                dialog.remove();
            });
            
            // Also allow clicking on overlay to close
            dialog.addEventListener('click', function(e) {
                if (e.target === dialog) {
                    dialog.remove();
                }
            });
            
            document.body.appendChild(dialog);
        }

        // Handle export based on selected format
        function handleExport(context) {
            const format = document.querySelector('input[name="export-format"]:checked').value;
            
            // Remove dialog
            document.querySelector('div[style*="position: fixed"]').remove();
            
            if (format === 'csv') {
                exportCSV(context);
            } else {
                exportJSON(context);
            }
        }

        // Export CSV
        function exportCSV(context) {
            if (context === 'settings') {
                // Export all data as CSV (simplified version)
// 🔍 Found another easter egg! You're persistent, I'll give you that! 👏
                const headers = ['Type', 'Name', 'Supervisor', 'Details'];
                const rows = [
                    ...agents.map(agent => ['Agent', agent, agentSupervisors[agent] || '', '']),
                    ...supervisors.map(supervisor => ['Supervisor', supervisor, '', '']),
                    ...crrData.map(crr => ['CRR', crr.agentName, crr.supervisor, `${crr.date} - Score: ${crr.totalScore}`])
                ];
                
                const csvContent = [headers, ...rows]
                    .map(row => row.map(cell => `"${cell}"`).join(','))
                    .join('\n');
                
                downloadFile(csvContent, 'text/csv', 'all-data.csv');
            } else {
                // Export CRR data as CSV with all columns present
                const headers = [
                    'Date', 'Agent', 'Supervisor', 'Interaction Type', 'Interaction Link',
                    'Expertise Score', 'Expertise Feedback', 'Ownership Score', 'Ownership Feedback',
                    'Articulation Score', 'Articulation Feedback', 'Proactiveness Score', 'Proactiveness Feedback', 'Total Score'
                ];
                
                const rows = crrData.map(crr => [
                    crr.date || '', 
                    crr.agentName || '', 
                    crr.supervisor || '', 
                    crr.interactionType || '', 
                    crr.interactionLink || '',
                    crr.expertise || 0, 
                    (crr.expertiseFeedback || '').replace(/"/g, '""'),
                    crr.ownership || 0, 
                    (crr.ownershipFeedback || '').replace(/"/g, '""'),
                    crr.articulation || 0, 
                    (crr.articulationFeedback || '').replace(/"/g, '""'),
                    crr.proactiveness || 0, 
                    (crr.proactivenessFeedback || '').replace(/"/g, '""'),
                    crr.totalScore || 0
                ]);
                
                // Ensure all rows have the same number of columns as headers
                const csvContent = [headers, ...rows]
                    .map(row => {
                        // Pad row with empty strings if it's shorter than headers
                        while (row.length < headers.length) {
                            row.push('');
                        }
                        // Truncate row if it's longer than headers
                        row = row.slice(0, headers.length);
                        return row.map(cell => `"${cell}"`).join(',');
                    })
                    .join('\n');
                
                downloadFile(csvContent, 'text/csv', 'crr-data.csv');
            }
        }

        // Export JSON
        function exportJSON(context) {
            const data = {
                crrData,
                agents,
                supervisors,
                agentSupervisors,
                exportedAt: new Date().toISOString()
            };
            
            const jsonContent = JSON.stringify(data, null, 2);
            downloadFile(jsonContent, 'application/json', 'crr-data.json');
        }

        // Download file
        function downloadFile(content, mimeType, filename) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
        }

        // Show Google Sheets import instructions
        function showGoogleSheetsInstructions(csvContent) {
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 1000;
            `;
            
            dialog.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 8px; max-width: 500px; width: 90%;">
                    <h3 style="margin: 0 0 20px 0; color: var(--gray-800);">Import to Google Sheets</h3>
                    <p style="margin: 0 0 15px 0; color: var(--gray-600);">Your CSV file has been downloaded. Here are your options:</p>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; color: var(--gray-700);">Option 1: Direct Import</h4>
                        <p style="margin: 0 0 10px 0; color: var(--gray-600); font-size: 14px;">
                            1. Click "Open Google Sheets" below<br>
                            2. Go to <strong>File → Import</strong><br>
                            3. Upload your downloaded CSV file<br>
                            4. Choose "Replace spreadsheet" and click "Import data"
                        </p>
                        
                        <h4 style="margin: 0 0 10px 0; color: var(--gray-700);">Option 2: Copy & Paste</h4>
                        <p style="margin: 0 0 10px 0; color: var(--gray-600); font-size: 14px;">
                            1. Click "Copy Data" below<br>
                            2. Click "Open Google Sheets" below<br>
                            3. Paste (Ctrl+V) into the new spreadsheet
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                        <button onclick="copyCSVData()" 
                                style="padding: 8px 16px; background: var(--success); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Copy Data
                        </button>
                        <button onclick="openGoogleSheets()" 
                                style="padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Open Google Sheets
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.closest('div').parentElement.remove()" 
                                style="padding: 8px 16px; border: 1px solid var(--gray-300); background: white; border-radius: 4px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            // Store CSV content for copying
            window.currentCSVData = csvContent;
            
            document.body.appendChild(dialog);
        }

        // Copy to Google Sheets with header options
        function copyToGoogleSheets() {
            const includeHeaders = document.getElementById('include-headers').checked;
            
            // Generate CSV data
            const headers = [
                'Date', 'Agent', 'Supervisor', 'Interaction Type', 'Interaction Link',
                'Expertise Score', 'Expertise Feedback', 'Ownership Score', 'Ownership Feedback',
                'Articulation Score', 'Articulation Feedback', 'Proactiveness Score', 'Proactiveness Feedback', 'Total Score'
            ];
            
            const rows = crrData.map(crr => [
                crr.date || '', 
                crr.agentName || '', 
                crr.supervisor || '', 
                crr.interactionType || '', 
                crr.interactionLink || '',
                crr.expertise || 0, 
                (crr.expertiseFeedback || '').replace(/"/g, '""'),
                crr.ownership || 0, 
                (crr.ownershipFeedback || '').replace(/"/g, '""'),
                crr.articulation || 0, 
                (crr.articulationFeedback || '').replace(/"/g, '""'),
                crr.proactiveness || 0, 
                (crr.proactivenessFeedback || '').replace(/"/g, '""'),
                crr.totalScore || 0
            ]);
            
            // Build CSV content with optional headers
            let csvContent;
            if (includeHeaders) {
                csvContent = [headers, ...rows]
                    .map(row => {
                        while (row.length < headers.length) {
                            row.push('');
                        }
                        row = row.slice(0, headers.length);
                        return row.map(cell => `"${cell}"`).join(',');
                    })
                    .join('\n');
            } else {
                csvContent = rows
                    .map(row => {
                        while (row.length < headers.length) {
                            row.push('');
                        }
                        row = row.slice(0, headers.length);
                        return row.map(cell => `"${cell}"`).join(',');
                    })
                    .join('\n');
            }
            
            // Format for Google Sheets (tab-separated)
            const formattedData = formatDataForSheets(csvContent);
            
            // Copy to clipboard
            if (navigator.clipboard) {
                navigator.clipboard.writeText(formattedData).then(() => {
                    showInfoModal(
                        '✅ Data Copied!',
                        'Your data has been copied to the clipboard.',
                        'Now open Google Sheets and paste (Ctrl+V or Cmd+V) into your spreadsheet.'
                    );
                    document.querySelector('div[style*="position: fixed"]').remove();
                }).catch(() => {
                    // Fallback for older browsers
                    copyToClipboardFallback(formattedData);
                });
            } else {
                copyToClipboardFallback(formattedData);
            }
        }

        // Fallback clipboard copy
        function copyToClipboardFallback(data) {
            const textArea = document.createElement('textarea');
            textArea.value = data;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showInfoModal(
                '✅ Data Copied!',
                'Your data has been copied to the clipboard.',
                'Now open Google Sheets and paste (Ctrl+V or Cmd+V) into your spreadsheet.'
            );
            document.querySelector('div[style*="position: fixed"]').remove();
        }

        // Copy CSV data to clipboard (legacy function)
        function copyCSVData() {
            if (navigator.clipboard && window.currentCSVData) {
                // Format data for proper Google Sheets import
                const formattedData = formatDataForSheets(window.currentCSVData);
                
                navigator.clipboard.writeText(formattedData).then(() => {
                    showInfoModal('✅ Data Copied!', 'Your CSV data has been copied to the clipboard.', 'Now open Google Sheets and paste (Ctrl+V or Cmd+V) into your spreadsheet.');
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = formattedData;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showInfoModal('✅ Data Copied!', 'Your CSV data has been copied to the clipboard.', 'Now open Google Sheets and paste (Ctrl+V or Cmd+V) into your spreadsheet.');
                });
            }
        }

        // Format CSV data for Google Sheets
        function formatDataForSheets(csvData) {
            // Split into lines
            const lines = csvData.split('\n');
            
            // Get header count for consistent column alignment
            const headerLine = lines[0];
            const headerFields = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < headerLine.length; i++) {
                const char = headerLine[i];
                
                if (char === '"' && !inQuotes) {
                    inQuotes = true;
                } else if (char === '"' && inQuotes) {
                    inQuotes = false;
                } else if (char === ',' && !inQuotes) {
                    headerFields.push(currentField.trim());
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            headerFields.push(currentField.trim());
            const expectedColumnCount = headerFields.length;
            
            // Process each line to ensure proper formatting
            const formattedLines = lines.map(line => {
                // Split by comma but respect quoted fields
                const fields = [];
                let currentField = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"' && !inQuotes) {
                        inQuotes = true;
                    } else if (char === '"' && inQuotes) {
                        inQuotes = false;
                    } else if (char === ',' && !inQuotes) {
                        fields.push(currentField.trim());
                        currentField = '';
                    } else {
                        currentField += char;
                    }
                }
                
                // Add the last field
// 🎯 You're so close to the premium features... just need to pay! 💳
                fields.push(currentField.trim());
                
                // Ensure consistent column count
                while (fields.length < expectedColumnCount) {
                    fields.push('');
                }
                fields.splice(expectedColumnCount); // Remove excess columns
                
                // Join with tabs (Google Sheets recognizes tabs as cell separators)
                return fields.join('\t');
            });
            
            return formattedLines.join('\n');
        }

        // Open Google Sheets
        function openGoogleSheets() {
            window.open('https://docs.google.com/spreadsheets/create', '_blank');
        }

        // Import data
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (confirm('This will replace all current data. Are you sure?')) {
                            crrData = data.crrData || [];
                            agents = data.agents || [];
                            supervisors = data.supervisors || [];
                            agentSupervisors = data.agentSupervisors || {};
                            
                            localStorage.setItem('crrData', JSON.stringify(crrData));
                            localStorage.setItem('agents', JSON.stringify(agents));
                            localStorage.setItem('supervisors', JSON.stringify(supervisors));
                            localStorage.setItem('agentSupervisors', JSON.stringify(agentSupervisors));
                            
                            showInfoModal(
                                '✅ Data Imported!',
                                'Your data has been imported successfully.',
                                'The page will refresh to show your imported data.'
                            );
                            setTimeout(() => location.reload(), 2000);
                        }
                    } catch (err) {
                        showInfoModal(
                            '❌ Import Error',
                            'There was a problem importing your data.',
                            'Please make sure the file is a valid JSON export from this tool.'
                        );
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('⚠️ This will delete ALL data including reviews and agents. Are you absolutely sure?')) {
                if (confirm('This cannot be undone. Click OK to proceed.')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        // Load sample data
        function loadSampleData() {
            if (crrData.length > 0 && !confirm('This will add sample data. Continue?')) return;
            
            // Add sample agents and supervisors if they don't exist
            const sampleAgents = ['Sarah Johnson', 'Mike Chen', 'Emily Rodriguez'];
            const sampleSupervisors = ['John Smith', 'Lisa Anderson'];
            
            sampleAgents.forEach(agent => {
                if (!agents.includes(agent)) {
                    agents.push(agent);
                }
            });
            
            sampleSupervisors.forEach(supervisor => {
                if (!supervisors.includes(supervisor)) {
                    supervisors.push(supervisor);
                }
            });
            
            // Set up sample agent-supervisor associations
            if (!agentSupervisors['Sarah Johnson']) agentSupervisors['Sarah Johnson'] = 'John Smith';
            if (!agentSupervisors['Mike Chen']) agentSupervisors['Mike Chen'] = 'Lisa Anderson';
            if (!agentSupervisors['Emily Rodriguez']) agentSupervisors['Emily Rodriguez'] = 'John Smith';
            
            localStorage.setItem('agents', JSON.stringify(agents));
            localStorage.setItem('supervisors', JSON.stringify(supervisors));
            localStorage.setItem('agentSupervisors', JSON.stringify(agentSupervisors));
            
            const sampleCRRs = [
                {
                    id: Date.now() - 1000000,
                    date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    agentName: 'Sarah Johnson',
                    supervisor: 'John Smith',
                    interactionType: 'Ticket',
                    interactionLink: 'https://support.example.com/ticket/1234',
                    expertise: 3,
                    ownership: 3,
                    articulation: 3,
                    proactiveness: 2,
                    totalScore: 11,
                    expertiseFeedback: 'Demonstrated exceptional product knowledge and projected confidence throughout the entire interaction.',
                    ownershipFeedback: 'Took full ownership even though it was a third-party plugin conflict. Acted as true ambassador.',
                    articulationFeedback: 'Perfect tone, personalized greeting, clear explanations without jargon.',
                    proactivenessFeedback: 'Could have suggested a documentation update to prevent this issue for others.'
                },
                {
                    id: Date.now() - 900000,
                    date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    agentName: 'Mike Chen',
                    supervisor: 'Lisa Anderson',
                    interactionType: 'Chat',
                    interactionLink: 'https://support.example.com/chat/5678',
                    expertise: 2,
                    ownership: 2,
                    articulation: 3,
                    proactiveness: 2,
                    totalScore: 9,
                    expertiseFeedback: '',
                    ownershipFeedback: '',
                    articulationFeedback: 'Clear communication and avoided jargon. Good explanation of the technical issue in terms the customer could understand.',
                    proactivenessFeedback: 'Opening was a bit generic. Could have personalized more based on the customer\'s site/industry.'
                },
                {
                    id: Date.now() - 800000,
                    date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    agentName: 'Emily Rodriguez',
                    supervisor: 'John Smith',
                    interactionType: 'Ticket',
                    interactionLink: 'https://support.example.com/ticket/9012',
                    expertise: 2,
                    ownership: 1,
                    articulation: 2,
                    proactiveness: 1,
                    totalScore: 6,
                    expertiseFeedback: '',
                    ownershipFeedback: 'Passed customer to web host without providing enough context or guidance. User felt abandoned and didn\'t know what to ask for.',
                    articulationFeedback: 'Led with apology which set wrong tone. Should have led with confidence instead.',
                    proactivenessFeedback: 'Missed opportunity to document this as a common issue or escalate to product team for better error messaging.'
                },
                {
                    id: Date.now() - 700000,
                    date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    agentName: 'Sarah Johnson',
                    supervisor: 'Lisa Anderson',
                    interactionType: 'Call',
                    interactionLink: 'https://support.example.com/call/3456',
                    expertise: 3,
                    ownership: 3,
                    articulation: 2,
                    proactiveness: 3,
                    totalScore: 11,
                    expertiseFeedback: 'Immediately identified the root cause and explained the underlying issue with confidence.',
                    ownershipFeedback: 'Complete ownership. Didn\'t pass to developers - created escalation note, gave workaround, and set timeline expectations.',
                    articulationFeedback: 'Used some technical jargon that may have confused the customer initially.',
                    proactivenessFeedback: 'Identified a bug and created a detailed escalation note for developers. This will prevent future customers from hitting the same issue.'
                },
                {
                    id: Date.now() - 600000,
                    date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    agentName: 'Mike Chen',
                    supervisor: 'John Smith',
                    interactionType: 'Ticket',
                    interactionLink: 'https://support.example.com/ticket/7890',
                    expertise: 3,
                    ownership: 2,
                    articulation: 3,
                    proactiveness: 2,
                    totalScore: 10,
                    expertiseFeedback: 'Deep product knowledge on display. Explained complex caching issue in simple terms.',
                    ownershipFeedback: '',
                    articulationFeedback: 'Perfect tone. Customer left thrilled according to their follow-up message. Personalized and warm throughout.',
                    proactivenessFeedback: ''
                }
            ];
            
            crrData = [...sampleCRRs, ...crrData];
            localStorage.setItem('crrData', JSON.stringify(crrData));
            
            // Update dropdowns with new agents/supervisors
            updateDropdowns();
            updateSettingsLists();
            
            // Navigate to All Reviews to show the sample data
            showView('all-reviews', document.querySelector('.nav-btn:nth-child(2)'));
            
            // Show welcome modal
            showInfoModal(
                '✅ Sample Data Loaded!',
                'You now have 5 sample reviews to explore. These show different scoring scenarios with varying feedback levels.',
                'Try adding your own CRR to see it alongside the sample reviews. Click "New CRR" to get started!'
            );
        }
        
        // Generic info modal (non-blocking, informational)
// 🎪 Step right up! See the amazing features you can't use! 🎭
        function showInfoModal(title, message, additionalInfo = '') {
            const modal = document.createElement('div');
            modal.className = 'info-modal-overlay';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white; padding: 35px; border-radius: 12px; max-width: 500px; width: 90%;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center;
                ">
                    <h2 style="margin: 0 0 15px 0; color: var(--primary); font-size: 24px;">${title}</h2>
                    <p style="color: var(--gray-700); margin-bottom: ${additionalInfo ? '20px' : '30px'}; font-size: 16px; line-height: 1.6;">
                        ${message}
                    </p>
                    ${additionalInfo ? `
                        <div style="background: var(--gray-50); padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 3px solid var(--primary);">
                            <p style="margin: 0; color: var(--gray-700); font-size: 14px; line-height: 1.5;">
                                💡 ${additionalInfo}
                            </p>
                        </div>
                    ` : ''}
                    <button class="close-info-modal" 
                            style="padding: 12px 32px; background: var(--primary); color: white; 
                                   border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 15px;">
                        Got it!
                    </button>
                </div>
            `;
            
            // Close on button click
            modal.querySelector('.close-info-modal').addEventListener('click', function() {
                modal.remove();
            });
            
            // Close on overlay click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }
        
        // CRR Saved modal with action buttons
        function showCRRSavedModal() {
            const modal = document.createElement('div');
            modal.className = 'crr-saved-modal-overlay';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); display: flex; align-items: center; 
                justify-content: center; z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white; padding: 35px; border-radius: 12px; max-width: 500px; width: 90%;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center;
                ">
                    <h2 style="margin: 0 0 15px 0; color: var(--success); font-size: 24px;">✅ CRR Saved!</h2>
                    <p style="color: var(--gray-700); margin-bottom: 30px; font-size: 16px; line-height: 1.6;">
                        Your review has been saved successfully and appears at the top of the list.
                    </p>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 15px;">
                        <button class="add-another-crr" 
                                style="padding: 14px 24px; background: var(--primary); color: white; 
                                       border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 15px;
                                       box-shadow: 0 2px 8px rgba(26, 35, 126, 0.2);">
                            ➕ Score Another CRR
                        </button>
                        <button class="view-team-reports" 
                                style="padding: 14px 24px; background: var(--gray-100); color: var(--gray-700); 
                                       border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 15px;">
                            📊 View Team Reports
                        </button>
                    </div>
                    
                    <button class="close-saved-modal" 
                            style="padding: 8px 16px; background: transparent; color: var(--gray-500); 
                                   border: none; cursor: pointer; font-size: 14px; text-decoration: underline;">
                        Stay on All Reviews
                    </button>
                </div>
            `;
            
            // Add another CRR button
            modal.querySelector('.add-another-crr').addEventListener('click', function() {
                modal.remove();
                showView('score-entry', document.querySelector('.nav-btn:first-child'));
            });
            
            // View team reports button
            modal.querySelector('.view-team-reports').addEventListener('click', function() {
                modal.remove();
                showView('team-overview', document.querySelector('.nav-btn:nth-child(4)'));
            });
            
            // Close button
            modal.querySelector('.close-saved-modal').addEventListener('click', function() {
                modal.remove();
            });
            
            // Close on overlay click
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }

        // DEMO VERSION - Some features disabled
        // Want the full version? Buy it! 💰
        function showDemoRestriction(feature) {
            const featureInfo = {
                export: {
                    title: "Export Your Data",
                    description: "Export your CRR data to CSV or JSON for analysis and reporting.",
                    benefits: ["CSV format for Excel/Google Sheets", "JSON for complete data backup", "Professional reporting"]
                },
                googleSheets: {
                    title: "Google Sheets Integration", 
                    description: "Seamlessly copy your data directly to Google Sheets.",
                    benefits: ["One-click copy to clipboard", "Perfect column alignment", "No manual formatting needed"]
                },
                import: {
                    title: "Data Import",
                    description: "Import your existing CRR data from other systems.",
                    benefits: ["Bulk data import", "JSON format support", "Data migration tools"]
                },
                dashboard: {
                    title: "Agent Dashboard",
                    description: "Individual agent performance tracking and analytics.",
                    benefits: ["Personal performance metrics", "Score trend analysis", "Individual improvement tracking"]
                },
                analytics: {
                    title: "Team Analytics",
                    description: "Comprehensive team performance insights and trends.",
                    benefits: ["Team performance charts", "Trend analysis", "Manager insights"]
                }
            };
            
            const info = featureInfo[feature];
            showUpsellModal(info.title, info.description, info.benefits);
        }
        
        function showUpsellModal(title, description, benefits) {
            const modal = document.createElement('div');
            modal.className = 'upsell-modal-overlay';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.7); display: flex; align-items: center; 
                justify-content: center; z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white; padding: 40px; border-radius: 12px; max-width: 500px; width: 90%;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center;
                ">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 20px;">
                        <img src="SS_logo.png" alt="Sustainable Support Logo" style="height: 35px; width: auto; border-radius: 4px;">
                        <h2 style="margin: 0; color: var(--primary); font-size: 24px;">${title}</h2>
                    </div>
                    
                    <p style="color: var(--gray-600); margin-bottom: 25px; font-size: 16px; line-height: 1.5;">
                        ${description}
                    </p>
                    
                    <div style="background: var(--gray-50); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <h3 style="margin: 0 0 15px 0; color: var(--gray-800); font-size: 18px;">✨ Premium Benefits:</h3>
                        <ul style="text-align: left; margin: 0; padding-left: 20px; color: var(--gray-700);">
                            ${benefits.map(benefit => `<li style="margin-bottom: 8px;">${benefit}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                        <h3 style="margin: 0 0 10px 0; color: white; font-size: 20px;">🚀 Get the Full Version</h3>
                        <p style="margin: 0; color: rgba(255,255,255,0.9); font-size: 14px;">
                            Complete CRR Scoring Tool with all features
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px;">
                        <a href="https://buildsustainablesupport.com" target="_blank" 
                           style="padding: 12px 24px; background: var(--primary); color: white; 
                                  text-decoration: none; border-radius: 6px; font-weight: 600;
                                  box-shadow: 0 4px 12px rgba(26, 35, 126, 0.3);">
                            💎 Buy Full Version - $100
                        </a>
                        <button class="close-upsell-modal" 
                                style="padding: 12px 24px; background: var(--gray-200); color: var(--gray-700); 
                                       border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">
                            Maybe Later
                        </button>
                    </div>
                    
                    <p style="font-size: 12px; color: var(--gray-500); margin: 0;">
                        💡 This is a demo version. Full version includes all features!
                    </p>
                </div>
            `;
            
            // Add click handler to close button
            modal.querySelector('.close-upsell-modal').addEventListener('click', function() {
                modal.remove();
            });
            
            // Also allow clicking on overlay to close
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }
        
        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

